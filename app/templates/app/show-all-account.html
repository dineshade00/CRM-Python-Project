{% extends 'app/base1.html' %}
{% block content %}
<!-- ============================================================== -->
<!-- Start right Content here -->
<!-- ============================================================== -->
<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">

            <!-- start page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-flex align-items-center justify-content-between">
                        <h4 class="mb-sm-0">All Staff Sallary Account Details</h4>

                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                                <li class="breadcrumb-item active">Staff Sallary Account Details</li>
                            </ol>
                        </div>

                    </div>
                </div>
            </div>
            <!-- end page title -->
            {% if messages %}
            <div class="container mt-2">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">All Account Details</h4>
                        </div>

                        <!-- Search & Show Entries -->
                        <div style="display: flex; justify-content: space-between; margin: 10px;">
                            <div>
                                Show
                                <select id="showEntries" style="padding: 2px 5px;">
                                    <option value="5">5</option>
                                    <option value="10" selected>10</option>
                                    <option value="20">20</option>
                                </select>
                                entries
                            </div>
                            <div>
                                <input type="search" id="searchInput" placeholder="Search Here..."
                                    style="padding: 5px; width: 200px;">
                            </div>
                        </div>

                        <!-- Table -->
                        <div class="card-body">
                            <table id="staffTable" class="table table-hover table-bordered table-striped"
                                style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                <thead>
                                    <tr>
                                        <th>Staff ID</th>
                                        <th>Staff Name</th>
                                        <th class="d-block d-md-none">More</th> <!-- Mobile ke liye -->
                                        <th class="d-none d-md-table-cell">Account Number</th>
                                        <th class="d-none d-md-table-cell">Bank Name</th>
                                        <th class="d-none d-md-table-cell">Salary Amount (‚Çπ)</th>
                                        <th class="d-none d-md-table-cell">Payment Mode</th>
                                        <th class="d-none d-md-table-cell">Manage Account</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for acc in salary_accounts %}
                                    <tr>
                                        <td>{{ acc.staff_id }}</td>
                                        <td>{{ acc.staff_name }}</td>

                                        <!-- Mobile Plus Icon -->
                                        <td class="d-block d-md-none text-center">
                                            <a href="javascript:void(0);" onclick="toggleRow(this)"
                                                style="font-size:18px; color:green; text-decoration:none;">+</a>
                                        </td>

                                        <!-- Hidden on mobile -->
                                        <td class="d-none d-md-table-cell">{{ acc.account_number }}</td>
                                        <td class="d-none d-md-table-cell">{{ acc.bank_name }}</td>
                                        <td class="d-none d-md-table-cell">{{ acc.salary_amount }}</td>
                                        <td class="d-none d-md-table-cell">{{ acc.salary_mode }}</td>
                                        <td class="d-none d-md-table-cell">
                                            <a href=""
                                                style="font-size:14px; padding:4px 8px; background:#17a2b8; color:white; border-radius:5px; text-decoration:none; margin-right:5px;">
                                                üìù
                                            </a>
                                            <a href="{% url 'delete-sallary-account' acc.id %}"
                                                style="font-size:14px; padding:2px 6px; background:#dc3545; color:white; border-radius:5px; text-decoration:none;"
                                                onclick="return confirm('Are you sure you want to delete this account?');">‚ùå</a>


                                        </td>
                                    </tr>

                                    <!-- Expandable Row (Hidden on desktop) -->
                                    <tr class="extra-row d-none d-md-none">
                                        <td colspan="3" style="background:#f9f9f9;">
                                            <strong>Account Number:</strong> {{ acc.account_number }} <br>
                                            <strong>Bank Name:</strong> {{ acc.bank_name }} <br>
                                            <strong>Salary Amount (‚Çπ):</strong> {{ acc.salary_amount }} <br>
                                            <strong>Payment Mode:</strong> {{ acc.salary_mode }} <br>
                                            <strong>Manage:</strong>
                                            <a href=""
                                                style="font-size:14px; padding:2px 6px; background:#17a2b8; color:white; border-radius:5px; text-decoration:none; margin-right:5px;">üìù</a>
                                            <a href="{% url 'delete-sallary-account' acc.id %}"
                                                style="font-size:14px; padding:2px 6px; background:#dc3545; color:white; border-radius:5px; text-decoration:none;"
                                                onclick="return confirm('Are you sure you want to delete this account?');">‚ùå</a>


                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="7" class="text-center text-muted">No Salary Accounts Found</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>

                            <!-- Pagination -->
                            <div id="pagination" style="display:flex; justify-content: flex-end; margin-top: 10px;">
                            </div>
                        </div>

                        <!-- JS -->


                    </div>
                </div>
            </div>


            <!-- end row -->
        </div>
        <!-- container-fluid -->
    </div>
    <!-- End Page-content -->




</div>
<!-- end main content-->

<script>
    const searchInput = document.getElementById("searchInput");
    const staffTable = document.getElementById("staffTable").getElementsByTagName("tbody")[0];
    const showEntries = document.getElementById("showEntries");
    const pagination = document.getElementById("pagination");

    let rows = staffTable.getElementsByTagName("tr");
    let currentPage = 1;
    let rowsPerPage = parseInt(showEntries.value);

    // Filter Rows
    searchInput.addEventListener("keyup", function () {
        let filter = searchInput.value.toLowerCase();
        for (let i = 0; i < rows.length; i++) {
            let text = rows[i].textContent.toLowerCase();
            rows[i].style.display = text.includes(filter) ? "" : "none";
        }
        currentPage = 1;
        setupPagination();
    });

    // Show Entries Change
    showEntries.addEventListener("change", function () {
        rowsPerPage = parseInt(this.value);
        currentPage = 1;
        setupPagination();
    });

    // Pagination Setup
    function setupPagination() {
        let visibleRows = Array.from(rows).filter(r => r.style.display !== "none");
        let totalPages = Math.ceil(visibleRows.length / rowsPerPage);
        pagination.innerHTML = "";

        // Prev Button
        let prevBtn = document.createElement("button");
        prevBtn.innerText = "<<";
        prevBtn.style.margin = "2px";
        prevBtn.style.padding = "5px 10px";
        prevBtn.style.border = "1px solid green";
        prevBtn.style.background = "";
        prevBtn.style.color = "green";
        prevBtn.style.borderRadius = "4px";
        prevBtn.disabled = currentPage === 1;
        prevBtn.onclick = function () {
            if (currentPage > 1) {
                currentPage--;
                displayPage();
                setupPagination();
            }
        };
        pagination.appendChild(prevBtn);

        // Page Numbers
        for (let i = 1; i <= totalPages; i++) {
            let btn = document.createElement("button");
            btn.innerText = i;
            btn.style.margin = "2px";
            btn.style.padding = "5px 10px";
            btn.style.border = "1px solid #ccc";
            btn.style.background = (i === currentPage) ? "#007bff" : "white";
            btn.style.color = (i === currentPage) ? "white" : "black";
            btn.style.borderRadius = "4px";
            btn.onclick = function () {
                currentPage = i;
                displayPage();
                setupPagination();
            };
            pagination.appendChild(btn);
        }

        // Next Button
        let nextBtn = document.createElement("button");
        nextBtn.innerText = ">>";
        nextBtn.style.margin = "2px";
        nextBtn.style.padding = "5px 10px";
        nextBtn.style.border = "1px solid green";
        nextBtn.style.background = "";
        nextBtn.style.color = "green";
        nextBtn.style.borderRadius = "4px";
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.onclick = function () {
            if (currentPage < totalPages) {
                currentPage++;
                displayPage();
                setupPagination();
            }
        };
        pagination.appendChild(nextBtn);

        displayPage();
    }

    // Display Current Page
    function displayPage() {
        let visibleRows = Array.from(rows).filter(r => r.style.display !== "none");
        let start = (currentPage - 1) * rowsPerPage;
        let end = start + rowsPerPage;

        visibleRows.forEach((row, index) => {
            row.style.display = (index >= start && index < end) ? "" : "none";
        });
    }

    // Init
    setupPagination();
</script>

<script>
    function toggleRow(el) {
        let row = el.closest("tr").nextElementSibling;
        if (row.classList.contains("d-none")) {
            row.classList.remove("d-none");
            el.innerHTML = "-"; // minus on expand
        } else {
            row.classList.add("d-none");
            el.innerHTML = "+"; // plus on collapse
        }
    }
</script>
{% endblock %}