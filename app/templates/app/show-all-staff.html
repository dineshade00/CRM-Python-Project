{% extends 'app/base1.html' %}
{% load static %}
{% block content %}


<!-- Begin page -->
<div id="layout-wrapper">


  <!-- ============================================================== -->
  <!-- Start right Content here -->
  <!-- ============================================================== -->
  <div class="main-content">
    <div class="page-content">
      <div class="container-fluid">
        <!-- start page title -->
        <div class="row">
          <div class="col-12">
            <div class="page-title-box d-flex align-items-center justify-content-between">
              <h4 class="mb-sm-0">Show All Staff</h4>

              <div class="page-title-right">
                <ol class="breadcrumb m-0">
                  <li class="breadcrumb-item">
                    <a href="index.html">Home</a>
                  </li>
                  <li class="breadcrumb-item active">Show All Staff</li>
                </ol>
              </div>
            </div>
          </div>
        </div>
        <!-- end page title -->

        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title">Show All Staff</h4>
              </div>
              <div class="card-body">

                <div class="row mb-3">
                  <!-- Left Side: Show Entries -->
                  <div class="col-md-6 d-flex align-items-center">
                    <label class="me-2">Show</label>
                    <select id="entriesSelect" class="form-select form-select-sm"
                      style="width: auto; display: inline-block;">
                      <option value="10">10</option>
                      <option value="25">25</option>
                      <option value="50">50</option>
                      <option value="100">100</option>
                    </select>
                    <label class="ms-2">entries</label>
                  </div>

                  <!-- Right Side: Search Bar -->
                  <div class="col-md-6 text-end">
                    <input type="text" id="searchInput" class="form-control form-control-sm d-inline-block"
                      style="width: 200px;" placeholder="Search...">
                  </div>
                </div>

                <!-- üîπ Table -->
                <table id="staffTable" class="table table-hover table-bordered table-striped dt-responsive nowrap"
                  style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                  <thead style="background-color: green;">
                    <tr class="tr bg-primary">
                      <th>Staff Id <i class="fas fa-sort"></i></th>
                      <th>Profile <i class="fas fa-sort"></i></th>
                      <th>First Name <i class="fas fa-sort"></i></th>
                      <th>Last Name <i class="fas fa-sort"></i></th>
                      <th>Contact <i class="fas fa-sort"></i></th>
                      <th>Email <i class="fas fa-sort"></i></th>
                      <th>Job Post <i class="fas fa-sort"></i></th>
                      <th>Action <i class="fas fa-sort"></i></th>
                    </tr>
                  </thead>
                  <tbody>
                    {% if members %}
                    {% for i in members %}
                    <tr>
                      <td>STAFF{{ i.id }}</td>
                      <!-- <td>
                        {% if i.photo %}
                        <img src="{{ i.photo.url }}" alt="{{ i.first_name }} {{ i.last_name }}" class="rounded-circle"
                          width="50" height="50" />
                        {% else %}
                        <img src="/static/assets/images/default-avatar.png" alt="No Photo" class="rounded-circle"
                          width="50" height="50" />
                        {% endif %}
                      </td> -->
                      <td>
                        {% if i.photo %}
                        <img src="{{ i.photo.url }}" alt="{{ i.first_name }} {{ i.last_name }}"
                          class="rounded-circle staff-profile" width="50" height="50" data-id="{{ i.id }}"
                          data-firstname="{{ i.first_name }}" data-lastname="{{ i.last_name }}"
                          data-email="{{ i.email }}" data-contact="{{ i.contact }}" data-job="{{ i.job_post }}"
                          data-gender="{{ i.gender }}" data-join="{{ i.joining_date }}" data-photo="{{ i.photo.url }}"
                          data-aadhar="{{ i.aadhar_number }}" data-pincode="{{ i.pincode }}" data-bs-toggle="modal"
                          data-bs-target="#staffModal" />
                        {% else %}
                        <img src="/static/assets/images/default-avatar.png" alt="No Photo"
                          class="rounded-circle staff-profile" width="50" height="50" data-id="{{ i.id }}"
                          data-firstname="{{ i.first_name }}" data-lastname="{{ i.last_name }}"
                          data-email="{{ i.email }}" data-contact="{{ i.contact }}" data-job="{{ i.job_post }}"
                          data-gender="{{ i.gender }}" data-join="{{ i.joining_date }}"
                          data-photo="/static/assets/images/default-avatar.png" data-aadhar="{{ i.aadhar_number }}"
                          data-pincode="{{ i.pincode }}" data-bs-toggle="modal" data-bs-target="#staffModal" />
                        {% endif %}
                      </td>


                      <td>{{ i.first_name }}</td>
                      <td>{{ i.last_name }}</td>
                      <td>{{ i.contact }}</td>
                      <td>{{ i.email }}</td>
                      <td>{{ i.job_post }}</td>
                      <td>

                        <a href="{% url 'manage-staff' i.id %}" class="btn btn-sm btn-info text-white"
                          data-bs-toggle="tooltip" data-bs-placement="top" title="Edit">
                          <i class="bi bi-pencil-square"></i>
                        </a>
                        <a href="{% url 'delete-staff' i.id %}" class="btn btn-sm btn-danger" data-bs-toggle="tooltip"
                          data-bs-placement="top" title="Delete"
                          onclick="return confirm('Are you sure you want to delete this staff?');">
                          <i class="bi bi-trash"></i>
                        </a>
                      </td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                      <td colspan="8" class="text-center">No staff found</td>
                    </tr>
                    {% endif %}
                  </tbody>
                </table>

                <!-- üîπ Pagination -->
                <div class="d-flex justify-content-between align-items-center mt-3">
                  <div>
                    <small id="tableInfo">Showing 1 to 10 of {{ members|length }} entries</small>
                  </div>
                  <nav>
                    <ul class="pagination pagination-sm mb-0" id="pagination">
                      <!-- Pagination buttons dynamically JS se banenge -->
                    </ul>
                  </nav>
                </div>

              </div>



            </div>
          </div>
          <!-- end col -->
        </div>

        <!-- end row -->
      </div>
      <!-- container-fluid -->
    </div>




  </div>
  <!-- end main content-->




  <!-- üîπ Staff Details Modal -->
  <div class="modal fade" id="staffModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content p-3">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Staff Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3 align-items-center">
            <!-- Column 1 -->
            <div class="col-md-4">
              <p class="mb-2"><b>First Name:</b> <span id="modalFirstName"></span></p>
              <p class="mb-2"><b>Last Name:</b> <span id="modalLastName"></span></p>
              <p class="mb-2"><b>Email:</b> <span id="modalEmail"></span></p>
            </div>
            <!-- Column 2 -->
            <div class="col-md-4">
              <p class="mb-2"><b>Contact:</b> <span id="modalContact"></span></p>
              <p class="mb-2"><b>Job Post:</b> <span id="modalJob"></span></p>
              <p class="mb-2"><b>Joining Date:</b> <span id="modalJoin"></span></p>
            </div>
            <!-- Column 3 -->
            <div class="col-md-4 text-center">
              <img id="modalPhoto" src="" alt="Profile" class="rounded-circle mb-2" width="130" height="130">
              <br>
              <button class="btn btn-success btn-sm mt-2" onclick="printIDCard()">üñ®Ô∏è Print ID Card</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- üîπ Hidden ID Card Template -->
  <div id="idCardTemplate" style="display:none;">
    <div class="id-card">
      <div class="id-header">
        <h4>CLIVAX GYM</h4>
        <p>Fitness ‚Ä¢ Strength ‚Ä¢ Power</p>
      </div>
      <div class="id-body " style="background-color: linear-gradient(#003366, #0073e6);color:darkblue;">
        <div style="text-align:center;">
          <img id="cardPhoto" src="" width="150" height="150" class="id-photo">

        </div>
        <h4 style="text-align:center; margin:10px 0;" id="cardName"></h4>

        <p style="padding-right: 25px;padding-left: 25px;"><b>ID No:</b> <span id="cardId"></span></p>
        <p style="padding-right: 25px;padding-left: 25px;"><b>Email:</b> <span id="cardEmail"></span></p>
        <p style="padding-right: 25px;padding-left: 25px;"><b>Contact:</b> <span id="cardContact"></span></p>
        <p style="padding-right: 25px;padding-left: 25px;"><b>Job Post:</b> <span id="cardJob"></span></p>
        <p style="padding-right: 25px;padding-left: 25px;"><b>Join Date:</b> <span id="cardJoin"></span></p>
      </div>
    </div>
  </div>



  <!-- üîπ Script -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".staff-profile").forEach(img => {
        img.addEventListener("mouseenter", showStaffModal);  // hover
        img.addEventListener("click", showStaffModal);       // click
      });

      function showStaffModal() {
        let data = this.dataset;

        // Fill Modal
        document.getElementById("modalFirstName").innerText = data.firstname;
        document.getElementById("modalLastName").innerText = data.lastname;
        document.getElementById("modalEmail").innerText = data.email;
        document.getElementById("modalContact").innerText = data.contact;
        document.getElementById("modalJob").innerText = data.job;
        document.getElementById("modalJoin").innerText = data.join;
        document.getElementById("modalPhoto").src = data.photo;

        // Fill Hidden ID Card
        document.getElementById("cardPhoto").src = data.photo;
        document.getElementById("cardName").innerText = data.firstname + " " + data.lastname;
        document.getElementById("cardId").innerText = "STAFF" + data.id;
        document.getElementById("cardEmail").innerText = data.email;
        document.getElementById("cardContact").innerText = data.contact;
        document.getElementById("cardJob").innerText = data.job;
        document.getElementById("cardJoin").innerText = data.join;
      }
    });

    // üîπ Print Function
    function printIDCard() {
      var printContents = document.getElementById("idCardTemplate").innerHTML;
      var w = window.open('', '', 'height=600,width=400');
      w.document.write('<html><head><title>ID Card</title>');
      w.document.write(`
    <style>
      body { -webkit-print-color-adjust: exact !important; color-adjust: exact !important; }
      .id-card { width: 350px; border: 2px solid #004080; border-radius: 10px; font-family: Arial, sans-serif; }
      .id-header { background: linear-gradient(#003366, #0073e6); color: white; padding: 10px; text-align: center;
                   border-top-left-radius: 10px; border-top-right-radius: 10px; }
      .id-body { padding: 15px; }
      .id-photo { border-radius: 50%; border: 2px solid #003366; }
    </style>
  `);
      w.document.write('</head><body>');
      w.document.write(printContents);
      w.document.write('</body></html>');
      w.document.close();
      w.print();
    }
  </script>


  <script>
    document.addEventListener("DOMContentLoaded", function () {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
      })
    });
  </script>

  <!-- ‚úÖ JS for Search, Pagination, Entries -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const table = document.getElementById("staffTable");
      const rows = Array.from(table.getElementsByTagName("tbody")[0].getElementsByTagName("tr"));
      const searchInput = document.getElementById("searchInput");
      const entriesSelect = document.getElementById("entriesSelect");
      const pagination = document.getElementById("pagination");
      const tableInfo = document.getElementById("tableInfo");

      let currentPage = 1;
      let rowsPerPage = parseInt(entriesSelect.value);

      function renderTable() {
        const searchTerm = searchInput.value.toLowerCase();
        let filteredRows = rows.filter(row => row.innerText.toLowerCase().includes(searchTerm));

        const totalRows = filteredRows.length;
        const totalPages = Math.ceil(totalRows / rowsPerPage);

        // Hide all rows
        rows.forEach(row => row.style.display = "none");

        // Show only rows of current page
        const start = (currentPage - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        filteredRows.slice(start, end).forEach(row => row.style.display = "");

        // Update info
        const showingStart = totalRows === 0 ? 0 : start + 1;
        const showingEnd = Math.min(end, totalRows);
        tableInfo.textContent = `Showing ${showingStart} to ${showingEnd} of ${totalRows} entries`;

        // Render pagination
        pagination.innerHTML = "";
        if (totalPages > 1) {
          const prev = `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
            <a class="page-link border-success text-success" href="#" aria-label="Previous">&laquo;</a>
          </li>`;
          pagination.insertAdjacentHTML("beforeend", prev);

          for (let i = 1; i <= totalPages; i++) {
            const li = `<li class="page-item ${i === currentPage ? 'active' : ''}">
              <a class="page-link border-success text-success" href="#">${i}</a>
            </li>`;
            pagination.insertAdjacentHTML("beforeend", li);
          }

          const next = `<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
            <a class="page-link border-success text-success" href="#" aria-label="Next">&raquo;</a>
          </li>`;
          pagination.insertAdjacentHTML("beforeend", next);
        }

        // Add click events
        pagination.querySelectorAll("a").forEach((a, idx, arr) => {
          a.addEventListener("click", function (e) {
            e.preventDefault();
            if (this.getAttribute("aria-label") === "Previous" && currentPage > 1) {
              currentPage--;
            } else if (this.getAttribute("aria-label") === "Next" && currentPage < totalPages) {
              currentPage++;
            } else if (!this.getAttribute("aria-label")) {
              currentPage = parseInt(this.textContent);
            }
            renderTable();
          });
        });
      }

      // Events
      searchInput.addEventListener("input", function () {
        currentPage = 1;
        renderTable();
      });

      entriesSelect.addEventListener("change", function () {
        rowsPerPage = parseInt(this.value);
        currentPage = 1;
        renderTable();
      });

      renderTable();
    });
  </script>

  {% endblock %}